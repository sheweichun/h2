{"version":3,"sources":["webpack:///exportData.js","webpack:///F:/workspace/miniapp/backend/manage/containers/exportData/index.js"],"names":["webpackJsonp","249","module","exports","__webpack_require__","_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","parseInputVal","val","lines","split","records","i","length","l","arr","Message","error","push","realName","phone","type","addBonus","typeName","defineProperty","_createClass","defineProperties","target","props","descriptor","key","protoProps","staticProps","_react2","_react","_moment2","_moment","_apiMap2","_apiMap","RangePicker","DatePicker","ExportData","state","range","subtract","batchBonus","batchBonusList","batchErrMsg","onChangeTime","bind","onExportBonus","onBatchAddBonus","_Component","console","log","this","setState","warning","start","format","end","window","open","ApiMap","param","url","show","content","duration","Fetch","JSON","stringify","then","resp","success","err","statusText","showTime","onChange","Button","onClick","Input","TextArea","placeholder","style","height","overflow","color","Component"],"mappings":"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","file":"exportData.js","sourcesContent":["webpackJsonp([20],{\n\n/***/ 249:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = __webpack_require__(2);\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactRouterDom = __webpack_require__(9);\n\nvar _next = __webpack_require__(3);\n\nvar _moment = __webpack_require__(0);\n\nvar _moment2 = _interopRequireDefault(_moment);\n\nvar _apiMap = __webpack_require__(8);\n\nvar _apiMap2 = _interopRequireDefault(_apiMap);\n\nvar _request = __webpack_require__(7);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar RangePicker = _next.DatePicker.RangePicker;\n\n\nfunction parseInputVal(val) {\n  var lines = val.split('\\n');\n  var records = [];\n  for (var i = 0; i < lines.length; i++) {\n    var l = lines[i];\n    // const arr = l.split('\\t')\n    var arr = l.split(/\\s+/);\n    if (arr.length !== 4) {\n      _next.Message.error('积分信息格式不正确, 少于四列');\n      return [];\n    }\n    records.push({ realName: arr[0], phone: arr[1], type: 7, addBonus: arr[2], typeName: arr[3] });\n  }\n  return records;\n}\n\nvar ExportData = function (_Component) {\n  _inherits(ExportData, _Component);\n\n  function ExportData(props) {\n    _classCallCheck(this, ExportData);\n\n    var _this = _possibleConstructorReturn(this, (ExportData.__proto__ || Object.getPrototypeOf(ExportData)).call(this, props));\n\n    _this.state = {\n      range: [(0, _moment2.default)().subtract(7, 'days'), (0, _moment2.default)()],\n      batchBonus: '',\n      batchBonusList: [],\n      batchErrMsg: ''\n    };\n    _this.onChangeTime = _this.onChangeTime.bind(_this);\n    _this.onExportBonus = _this.onExportBonus.bind(_this);\n    _this.onBatchAddBonus = _this.onBatchAddBonus.bind(_this);\n    return _this;\n  }\n\n  _createClass(ExportData, [{\n    key: 'onChangeTime',\n    value: function onChangeTime(val) {\n      console.log('val :', val);\n      this.setState({\n        range: val\n      });\n    }\n  }, {\n    key: 'onExportBonus',\n    value: function onExportBonus() {\n      var range = this.state.range;\n\n      if (!range || range.length !== 2 || !range[0] || !range[1]) {\n        return _next.Message.warning('请选择日期');\n      }\n      var start = range[0].format('YYYY-MM-DD HH:mm:ss');\n      var end = range[1].format('YYYY-MM-DD HH:mm:ss');\n      console.log('go here!!');\n      window.open(_apiMap2.default['exportAllBonusInfo'].param.url + '?query=a.create_time >= \\'' + start + '\\' and a.create_time <= \\'' + end + '\\'');\n    }\n  }, {\n    key: 'onBatchAddBonus',\n    value: function onBatchAddBonus() {\n      var _this2 = this;\n\n      // Message.loading('批量添加中...')\n      _next.Message.show({\n        type: 'loading',\n        content: '批量添加中...',\n        duration: 0\n      });\n      this.setState({\n        batchErrMsg: ''\n      });\n      (0, _request.Fetch)('batchAddBonus', {\n        records: JSON.stringify(this.state.batchBonusList)\n      }).then(function (resp) {\n        _next.Message.success('批量添加成功');\n        _this2.setState({\n          batchBonus: '',\n          batchBonusList: []\n        });\n      }, function (err) {\n        console.error(err);\n        _next.Message.error('批量添加失败 :' + err.statusText);\n        _this2.setState({\n          batchErrMsg: err.statusText\n        });\n      });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var _this3 = this;\n\n      var _state = this.state,\n          range = _state.range,\n          batchBonus = _state.batchBonus,\n          batchBonusList = _state.batchBonusList,\n          batchErrMsg = _state.batchErrMsg;\n\n      return _react2.default.createElement(\n        'div',\n        null,\n        'export',\n        _react2.default.createElement(RangePicker, { showTime: true, value: range, onChange: this.onChangeTime }),\n        _react2.default.createElement(\n          _next.Button,\n          { type: 'primary', onClick: this.onExportBonus },\n          '\\u5BFC\\u51FA\\u79EF\\u5206\\u4FE1\\u606F'\n        ),\n        _react2.default.createElement(\n          'div',\n          null,\n          _react2.default.createElement(\n            'div',\n            null,\n            '\\u6279\\u91CF\\u6DFB\\u52A0\\u79EF\\u5206\\uFF0C\\u8BF7\\u586B\\u5165\\u4FE1\\u606F\\u3010\\u8BF7\\u614E\\u7528\\u3011'\n          ),\n          _react2.default.createElement(_next.Input.TextArea, { placeholder: '\\u8BF7\\u8F93\\u5165\\u79EF\\u5206\\u4FE1\\u606F', value: batchBonus, onChange: function onChange(val) {\n              _this3.setState({\n                batchBonus: val,\n                batchBonusList: parseInputVal(val)\n              });\n            } }),\n          _react2.default.createElement(\n            'div',\n            null,\n            '\\u8BB0\\u5F55\\u6570\\uFF1A ',\n            batchBonusList.length\n          ),\n          _react2.default.createElement(\n            'pre',\n            { style: { height: '400px', overflow: 'auto' } },\n            JSON.stringify(batchBonusList, null, '\\t')\n          ),\n          _react2.default.createElement(\n            'div',\n            null,\n            _react2.default.createElement(\n              'div',\n              null,\n              '\\u9519\\u8BEF\\u4FE1\\u606F\\uFF1A'\n            ),\n            _react2.default.createElement(\n              'pre',\n              { style: { color: 'red', height: '100px', overflow: 'auto' } },\n              batchErrMsg\n            )\n          ),\n          _react2.default.createElement(\n            _next.Button,\n            { type: 'primary', onClick: this.onBatchAddBonus },\n            '\\u6279\\u91CF\\u6DFB\\u52A0'\n          )\n        )\n      );\n    }\n  }]);\n\n  return ExportData;\n}(_react.Component);\n\nexports.default = ExportData;\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// exportData.js","\r\nimport React, { Component } from 'react'\r\nimport {\r\n    Route,\r\n    Switch\r\n  } from 'react-router-dom'\r\nimport { DatePicker, Button, Message, Input } from '@alife/next'\r\nimport moment from 'moment'\r\nimport ApiMap from '../../util/apiMap'\r\nimport { Fetch } from '../../util/request'\r\nconst { RangePicker } = DatePicker\r\n\r\nfunction parseInputVal(val) {\r\n  const lines = val.split('\\n')\r\n  const records = []\r\n  for (let i = 0; i < lines.length; i++) {\r\n    const l = lines[i]\r\n    // const arr = l.split('\\t')\r\n    const arr = l.split(/\\s+/)\r\n    if (arr.length !== 4) {\r\n      Message.error('积分信息格式不正确, 少于四列')\r\n      return []\r\n    }\r\n    records.push({realName: arr[0], phone: arr[1], type: 7, addBonus: arr[2], typeName: arr[3]})\r\n  }\r\n  return records\r\n}\r\n\r\nclass ExportData extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      range: [moment().subtract(7, 'days'), moment()],\r\n      batchBonus: '',\r\n      batchBonusList: [],\r\n      batchErrMsg: ''\r\n    }\r\n    this.onChangeTime = this.onChangeTime.bind(this)\r\n    this.onExportBonus = this.onExportBonus.bind(this)\r\n    this.onBatchAddBonus = this.onBatchAddBonus.bind(this)\r\n  }\r\n  onChangeTime(val) {\r\n    console.log('val :', val)\r\n    this.setState({\r\n      range: val\r\n    })\r\n  }\r\n  onExportBonus() {\r\n    const {range} = this.state\r\n    if (!range || range.length !== 2 || !range[0] || !range[1]) {\r\n      return Message.warning('请选择日期')\r\n    }\r\n    const start = range[0].format('YYYY-MM-DD HH:mm:ss')\r\n    const end = range[1].format('YYYY-MM-DD HH:mm:ss')\r\n    console.log('go here!!')\r\n    window.open(`${ApiMap['exportAllBonusInfo'].param.url}?query=a.create_time >= '${start}' and a.create_time <= '${end}'`)\r\n  }\r\n  onBatchAddBonus() {\r\n    // Message.loading('批量添加中...')\r\n    Message.show({\r\n      type: 'loading',\r\n      content: '批量添加中...',\r\n      duration: 0\r\n    })\r\n    this.setState({\r\n      batchErrMsg: ''\r\n    })\r\n    Fetch('batchAddBonus', {\r\n      records: JSON.stringify(this.state.batchBonusList)\r\n    }).then((resp) => {\r\n      Message.success('批量添加成功')\r\n      this.setState({\r\n        batchBonus: '',\r\n        batchBonusList: []\r\n      })\r\n    }, (err) => {\r\n      console.error(err)\r\n      Message.error('批量添加失败 :' + err.statusText)\r\n      this.setState({\r\n        batchErrMsg: err.statusText\r\n      })\r\n    })\r\n  }\r\n  render() {\r\n    const { range, batchBonus, batchBonusList, batchErrMsg } = this.state\r\n    return (\r\n            <div>\r\n               export\r\n               <RangePicker showTime value={range} onChange={this.onChangeTime}></RangePicker>\r\n               {/* <a target=\"_blank\" href={ApiMap['exportAllBonusInfo'].param.url} onClick={this.onExportBonus}> */}\r\n                <Button type=\"primary\" onClick={this.onExportBonus}>\r\n                    导出积分信息\r\n                </Button>\r\n               {/* </a> */}\r\n\r\n               <div>\r\n                  <div>\r\n                    批量添加积分，请填入信息【请慎用】\r\n                  </div>\r\n                  <Input.TextArea placeholder=\"请输入积分信息\" value={batchBonus} onChange={(val) => {\r\n                    this.setState({\r\n                      batchBonus: val,\r\n                      batchBonusList: parseInputVal(val)\r\n                    })\r\n                  }}/>\r\n                  <div>\r\n                    记录数： {batchBonusList.length}\r\n                  </div>\r\n                  <pre style={{height: '400px', overflow: 'auto'}}>\r\n                    {JSON.stringify(batchBonusList, null, '\\t')}\r\n                  </pre>\r\n                  <div>\r\n                    <div>错误信息：</div>\r\n                    <pre style={{color: 'red', height: '100px', overflow: 'auto'}}>\r\n                    {batchErrMsg}\r\n                    </pre>\r\n                  </div>\r\n                  <Button type=\"primary\" onClick={this.onBatchAddBonus}>\r\n                      批量添加\r\n                  </Button>\r\n\r\n               </div>\r\n            </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default ExportData\r\n\n\n\n// WEBPACK FOOTER //\n// F:/workspace/miniapp/backend/manage/containers/exportData/index.js"],"sourceRoot":""}